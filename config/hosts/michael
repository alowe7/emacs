(setq binary-process-input t
      binary-process-output nil)
(require 'xz-loads)

(require 'worlds)

; this is for vizemacs
;(require 'gnuserv)
;(gnuserv-start)

;(menu-bar-mode -1)

;(debug-on-entry 'crypt-dos-to-unix-region) ; i wonder if this is getting called

; initialization specific to machine woody

; (setq doc-directory (concat (getenv "EMACSDIR") "/etc/"))

;(defun review-commands () (interactive)
;  (let ((v  
;  (catch 'done
;    (mapcar '(lambda (x) (if (y-or-n-q-p (format "%s" x)) (throw 'done x)))
;      command-history))))
;    (and v (eval v)))
;)

;(global-set-key '[M-up] 'review-commands)




;(setq *people-database*  "/a/notes/people")
;(setq *psw-people*  "/a/notes/extensions")

(defvar compile-command "make") 

(global-set-key "?" 'find-any-fn)
(autoload 'find-any-fn "xosus" "find the xosus or win32 function doc." t)

(load "ntime" nil t) ; for display-time
(display-time)

(defun delete-all-other-frames ()
  (interactive)
  "delete all frames except the currently focused one."
  (loop for f in (frame-list) 
	unless (eq f (selected-frame))
	do (delete-frame f)
	)
  )

;(setq manual-formatted-dirlist (catlist (getenv "MANPATH")))
(setq manual-formatted-dir-prefix "cat")

; use $MANPATH
(setq mandirs (list ($ "$H/a/man") ($ "$U/usr/share/man") ($ "$U/usr/local/man")))
(make-manvec)

(autoload 'myman "myman")

; xz-squish is currently global.  todo: make per process
(add-hook 'xz-load-hook '(lambda () 
													 (xz-squish 2)
													 (setq *xz-lastdb* "~/emacs/.xz.dat")
	
													 (load-library "xz-helpers")
													 )
					)
; this will slow down process loading a bit
;; (autoload  'xz-updatep "xzupdate")
;; (add-hook 'start-xz-process-hook 
;; 					'(lambda ()
;;						 (and (string= default-directory "~/emacs/lisp/") (xz-updatep))))

; from url.el

(defvar url-be-asynchronous t
  "*Controls whether document retrievals over HTTP should be done in
the background.  This allows you to keep working in other windows
while large downloads occur.")
(make-variable-buffer-local 'url-be-asynchronous)
(set-default 'url-be-asynchronous t)


(defvar url-basic-auth-storage nil
  "Where usernames and passwords are stored.  Its value is an assoc list of
assoc lists.  The first assoc list is keyed by the server name.  The cdr of
this is an assoc list based on the 'directory' specified by the url we are
looking up.")

(defun w3-diddle-mode-line () 
  (setq mode-line-process (format "  %s" (url-view-url))))

(add-hook 'w3-draw-done-hooks 'w3-diddle-mode-line)

(autoload 'ihw "w3-helpers" "scan a mail message for html" t)

(setq lastdial "psw isdn")

; assume anything in these directories is lisp
(nconc auto-mode-alist
       '(("emacs/lisp" . emacs-lisp-mode)
	 ("emacs/site-lisp" . emacs-lisp-mode)
	 ("emacs/config" . emacs-lisp-mode)))

(global-set-key (vector 'f5) '
		(lambda () (interactive)
		  (revert-buffer nil t)))

(defun ftime () (interactive)

  (let ((f (elt (file-attributes (buffer-file-name)) 5)))
    (message (eval-process "mktime" "-v" (format "\"%s %s\"" (car f) (cadr f))))
    )
  )
(global-set-key (vector 'f10) 'ftime)
(global-set-key (vector 'f3) 'pod)

;; more stupid hook tricks...

(when nil
  (add-hook
   'world-change-hook
   (function 
    (lambda ()
      (dotimes (x 9)
	(funcall 'setenv (concat "D" (int-to-string x))))

      ;;  (scan-file (get-world world))
      (mapcar 'ksh-parse-line
	      (cdr
	       (catlist
		(eval-process "awk" 
			      (format
			       "'{if ($1 == \"%s\") {print $0}}'" world) 
			      "/w/active") ? )))
      )
    )
   )
  )

; allows sentences to end with a single space
(setq sentence-end "[.?!][]\"')}]*\\($\\| $\\|	\\| \\)[ 	
]*")

(load-library "world-advice")
(setq explicit-shell-file-name "bash")

(require 'mount)

(add-hook 'fb-mode-hook 'fb-additional-setup)

(defun fb-file-info () (interactive)
  "
 0. t for directory, string (name linked to) for symbolic link, or nil.
 1. Number of links to file.
 2. File uid.
 3. File gid.
 4. Last access time, as a list of two integers.
  First integer has high-order 16 bits of time, second has low 16 bits.
 5. Last modification time, likewise.
 6. Last status change time, likewise.
 7. Size in bytes.
  This is a floating point number if the size is too large for an integer.
 8. File modes, as a string of ten letters or dashes as in ls -l.
 9. t iff file's gid would change if file were deleted and recreated.
10. inode number.  If inode number is larger than the Emacs integer,
  this is a cons cell containing two integers: first the high part,
  then the low 16 bits.
11. Device number.
"
  (let* ((fn (indicated-word))
	 (a (file-attributes fn)))
  ; -rw-r--r--   1 544      everyone     2655 Mar 28  1998 woody
    (if a
	(message "%s %-4d %-4d %s %d %s %s"

	    (elt a 8)
	    (elt a 3)
	    (elt a 2)
	    "everyone"
	    (elt a 7)
	    (format-time-string "%b %d %Y" (elt a 5))
	    (file-name-nondirectory fn)
	    )
      (message "file not found"))
    )
  )

(defun fb-additional-setup () 
  (define-key fb-mode-map "i" 'fb-file-info)
  )


(add-hook 'world-post-change-hook 'update-world-shortcut)
(defun update-world-shortcut () 
  (update-shortcut
   (find-world-directory)
   (concat (my-documents) "\\w.lnk")
  )

  (update-shortcut
   (find-world-directory)
   (concat (quicklaunch) "\\w.lnk")
  )

)

(defun fwd ()
  "find the upstream world directory, if it exists"
  (interactive)
  (let ((f 
	 (concat
	  (target "/f")
	  "/d/"
	  (current-world))))
    (and (file-exists-p f) (find-file f))
    )
  )

(set-default-font "-*-Lucida Console-normal-r-*-*-16-120-96-96-c-*-iso8859-1")
;(set-default-font "-*-Lucida Sans Typewriter-normal-r-*-*-16-120-96-96-c-*-iso8859-1")


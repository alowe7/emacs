#!/usr/local/bin/perl
#  $Id$

use Sys::Hostname;
use POSIX qw(uname);
use Getopt::Long;

GetOptions(
 	   'dir|d=s' => \$dir);

$dir="." unless $dir;

# canonical host names are not case sensitive, but filenames might be
my($hostname)= lc(hostname());
my($sysname, $nodename, $release, $version, $machine) = uname();

# XXX
$sysname="W32" unless ($sysname cmp "Windows NT");

# use bare hostname in case its fully qualified
($host,undef,$domain)=($hostname=~ /^(\w+)(\.)(.*)/);
$hostname=$host if ($host);

# XXX this reflects config.el paths.  should just ask it to tell me, or let emacs compute it.

if (defined $ENV{EMACSPATH}) {
    $emacs= $ENV{EMACSPATH} . "/emacs";
}
else {
    $emacs=`which emacs`;
    chomp $emacs;
}

# this fails under cygwin
# die "you lose ($emacs)" unless (-x $emacs);

# $cmd="$emacs --batch --eval \"(message (format \\\"%d %d.%d\\\" emacs-major-version emacs-major-version emacs-minor-version))\"";
$cmd="$emacs --batch --eval \"(message (format \\\"%d\\\" emacs-major-version))\"";
$emacscfg=`$cmd 2>&1`;
chomp $emacscfg;
$cmd="find $dir -type f -name \"*.el\" -a \\( -path \"*common*\" -o -path \"*$sysname*\" -o -path \"*/$hostname/*\" -o -path \"*$emacscfg*\" \\)";
map {print} (`$cmd`);



